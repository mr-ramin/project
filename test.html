<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مسابقه کوییز حرفه‌ای</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Vazirmatn','Segoe UI',sans-serif; }
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap');

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        @keyframes gradient { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

        .quiz-container {
            background: rgba(20, 25, 40, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            width: 100%;
            max-width: 920px;
            min-height: 650px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* انیمیشن‌های نرم */
        @keyframes slideUp { from { opacity:0; transform:translateY(40px); } to { opacity:1; transform:translateY(0); } }
        @keyframes bounceIn { 0% { transform:scale(0.3); opacity:0; } 50% { transform:scale(1.1); } 70% { transform:scale(0.9); } 100% { transform:scale(1); opacity:1; } }
        @keyframes pulse { 0% { transform:scale(1); } 50% { transform:scale(1.05); } 100% { transform:scale(1); } }

        .animate-up { animation: slideUp 0.7s ease forwards; }
        .bounce { animation: bounceIn 0.8s ease; }
        .pulse { animation: pulse 0.6s; }

        .header { background: linear-gradient(135deg, #0c2461, #1e3799); padding: 18px; text-align: center; display: none; position:relative; }
        .timer { background:#e74c3c; padding:12px 32px; border-radius:50px; font-weight:bold; font-size:20px; box-shadow:0 0 20px rgba(231,76,60,0.6); animation:pulse 2s infinite; }

        .progress-container { height:10px; background:rgba(255,255,255,0.1); border-radius:10px; overflow:hidden; margin:20px 40px; }
        #progress-bar { height:100%; width:0%; background:linear-gradient(90deg,#3498db,#2ecc71); transition:width 0.6s ease; border-radius:10px; }

        .question-section { padding:30px 40px; display:none; }
        .question-number { font-size:22px; color:#3498db; margin-bottom:15px; font-weight:bold; opacity:0; animation:slideUp 0.8s 0.2s forwards; }
        .question-text { background:rgba(44,62,80,0.7); padding:30px; border-radius:20px; font-size:24px; margin-bottom:30px; min-height:120px; display:flex; align-items:center; justify-content:center; text-align:center; opacity:0; animation:slideUp 0.8s 0.4s forwards; }

        .options-container { display:grid; gap:20px; margin-bottom:40px; }
        .option {
            background:rgba(44,62,80,0.8);
            border:3px solid transparent;
            padding:22px;
            border-radius:20px;
            cursor:pointer;
            transition:all 0.4s ease;
            font-size:19px;
            backdrop-filter:blur(5px);
        }
        .option:hover { border-color:#3498db; transform:translateY(-5px); box-shadow:0 10px 25px rgba(0,0,0,0.3); }
        .option.correct { background:#27ae60 !important; border-color:#27ae60 !important; animation:bounceIn 0.7s; }
        .option.wrong { background:#e74c3c !important; border-color:#e74c3c !important; animation:pulse 0.6s; }

        .navigation-buttons { display:flex; flex-direction:column; align-items:center; gap:20px; margin-top:30px; }
        .btn {
            padding:18px 50px;
            border:none;
            border-radius:50px;
            font-size:20px;
            font-weight:bold;
            cursor:pointer;
            min-width:280px;
            transition:all 0.4s;
            display:flex;
            align-items:center;
            justify-content:center;
            gap:12px;
        }
        .btn-primary { background:linear-gradient(135deg,#2980b9,#3498db); box-shadow:0 8px 20px rgba(52,152,219,0.4); }
        .btn-primary:hover { transform:translateY(-5px); box-shadow:0 15px 30px rgba(52,152,219,0.6); }

        .resultfonline { padding:50px 30px; text-align:center; display:none; }
        .score-circle { width:200px; height:200px; border-radius:50%; background:linear-gradient(135deg,#2980b9,#2c3e50); margin:0 auto 30px; display:flex; align-items:center; justify-content:center; font-size:60px; font-weight:bold; animation:bounceIn 1s; box-shadow:0 20px 40px rgba(0,0,0,0.5); }

        .leaderboard { background:rgba(44,62,80,0.7); padding:25px; border-radius:20px; margin:30px 0; }
        .lb-item { display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid rgba(255,255,255,0.1); font-size:18px; }
        .lb-rank { color:#f1c40f; font-weight:bold; }

        @media (max-width:768px) {
            .btn { min-width:240px; font-size:18px; }
            .question-text { font-size:21px; padding:25px; }
            .score-circle { width:160px; height:160px; font-size:48px; }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <!-- صفحه شروع -->
        <div class="start-screen animate-up" id="start-screen" style="padding:50px 20px;text-align:center;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;">
            <h1 class="start-title bounce" style="font-size:42px;color:#3498db;margin-bottom:20px;">کوییز حرفه‌ای</h1>
            <p style="font-size:20px;line-height:2;max-width:700px;color:#ecf0f1;">
                ۱۰ سوال | ۲ دقیقه زمان | اشتباه = امتیاز منفی<br>
                <b style="color:#f1c40f">پاسخ بعد از انتخاب قفل می‌شود!</b>
            </p>
            <button class="btn btn-primary bounce" onclick="startQuiz()" style="margin-top:40px;font-size:24px;padding:20px 70px;">
                شروع مسابقه
            </button>
        </div>

        <div class="header" id="quiz-header">
            <div class="timer" id="timer">02:00</div>
            <div class="progress-container"><div id="progress-bar"></div></div>
        </div>

        <div class="question-section" id="question-section">
            <div id="question-content" style="display:none;">
                <div class="question-number" id="question-number">سوال ۱ از ۱۰</div>
                <div class="question-text" id="question-text"></div>
                <div class="options-container" id="options-container"></div>

                <div class="navigation-buttons">
                    <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()">سوال بعدی</button>
                    <button class="btn btn-primary" style="background:#7f8c8d;" id="prev-btn" onclick="previousQuestion()">سوال قبلی</button>
                </div>
            </div>
        </div>

        <div class="result-section" id="result-section">
            <div class="score-circle" id="final-score">0</div>
            <h2 id="motivational-message" style="font-size:32px;color:#f1c40f;margin:20px 0;"></h2>
            
            <div class="leaderboard">
                <h3 style="margin-bottom:15px;color:#3498db;"> رتبه‌بندی برتر</h3>
                <div id="leaderboard-list"></div>
                <input type="text" id="player-name" placeholder="نام خود را وارد کنید" style="width:100%;padding:15px;margin:15px 0;border-radius:50px;border:none;text-align:center;font-size:18px;">
                <button class="btn btn-primary" onclick="saveScore()" style="width:100%;">ذخیره امتیاز</button>
            </div>

            <button class="btn btn-primary" onclick="restartQuiz()" style="margin-top:20px;background:#27ae60;">چالش مجدد</button>
        </div>
    </div>

    <audio id="correct-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"></audio>
    <audio id="wrong-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-bass-buzzer-948.mp3"></audio>

    <script>
        let currentQuestionIndex = 0, userAnswers = [], correctCount = 0, wrongCount = 0;
        let timer, timeLeft = 120, selectedQuestions = [], allQuestions = [];
        const correctSound = document.getElementById('correct-sound');
        const wrongSound = document.getElementById('wrong-sound');

        function startQuiz() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('quiz-header').style.display = 'block';
            document.getElementById('question-section').style.display = 'block';
            currentQuestionIndex = correctCount = wrongCount = 0;
            userAnswers = new Array(10).fill(null);
            timeLeft = 120;
            updateTimer();
            loadQuestions();
            startTimer();
        }

        async function loadQuestions() {
            try {
                const res = await fetch('questions.json');
                const data = await res.json();
                allQuestions = data.questions;
                const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
                selectedQuestions = shuffled.slice(0, 10);
                document.getElementById('question-content').style.display = 'block';
                displayCurrentQuestion();
            } catch { alert('فایل questions.json پیدا نشد!'); }
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 0) { clearInterval(timer); showResults(); }
            }, 1000);
        }

        function updateTimer() {
            const m = String(Math.floor(timeLeft/60)).padStart(2,'0');
            const s = String(timeLeft%60).padStart(2,'0');
            document.getElementById('timer').textContent = `\( {m}: \){s}`;
        }

        function typeWriter(text, element) {
            element.textContent = '';
            let i = 0;
            const interval = setInterval(() => {
                element.textContent += text.charAt(i);
                i++;
                if (i > text.length) clearInterval(interval);
            }, 40);
        }

        function displayCurrentQuestion() {
            const q = selectedQuestions[currentQuestionIndex];
            document.getElementById('question-number').textContent = `سوال ${currentQuestionIndex + 1} از ۱۰`;
            typeWriter(q.question, document.getElementById('question-text'));

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'option animate-up';
                div.textContent = opt;
                div.style.animationDelay = `${0.1 + i*0.1}s`;

                if (userAnswers[currentQuestionIndex] !== null) {
                    if (i === q.correct) div.classList.add('correct');
                    else if (i === userAnswers[currentQuestionIndex]) div.classList.add('wrong');
                    div.style.cursor = 'not-allowed';
                } else {
                    div.onclick = () => selectOption(i);
                }
                container.appendChild(div);
            });

            document.getElementById('progress-bar').style.width = ((currentQuestionIndex + 1)/10 * 100) + '%';
            document.getElementById('prev-btn').style.display = currentQuestionIndex === 0 ? 'none' : 'block';
            document.getElementById('next-btn').innerHTML = currentQuestionIndex === 9 ? 'پایان مسابقه' : 'سوال بعدی';
        }

        function selectOption(idx) {
            if (userAnswers[currentQuestionIndex] !== null) return;

            const q = selectedQuestions[currentQuestionIndex];
            userAnswers[currentQuestionIndex] = idx;

            if (idx === q.correct) {
                correctCount++;
                correctSound.play();
                if ('vibrate' in navigator) navigator.vibrate([100, 50, 100]);
            } else {
                wrongCount++;
                wrongSound.play();
                if ('vibrate' in navigator) navigator.vibrate(200);
            }

            displayCurrentQuestion();
        }

        function nextQuestion() {
            if (currentQuestionIndex < 9) {
                currentQuestionIndex++;
                displayCurrentQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayCurrentQuestion();
            }
        }

        function showResults() {
            clearInterval(timer);
            const unanswered = userAnswers.filter(a => a === null).length;
            const netScore = Math.max(0, correctCount - Math.floor(wrongCount / 2));
            const percent = Math.round((netScore / 10) * 100);

            document.getElementById('final-score').textContent = percent + '%';
            document.getElementById('motivational-message').textContent = 
                percent >= 90 ? "استاد مطلق!" :
                percent >= 70 ? "عالی بودی!" :
                percent >= 50 ? "خوبه، بهتر می‌شی!" : "دوباره تلاش کن!";

            if (percent >= 70) confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });

            document.getElementById('question-section').style.display = 'none';
            document.getElementById('quiz-header').style.display = 'none';
            document.getElementById('result-section').style.display = 'block';

            loadLeaderboard();
        }

        function loadLeaderboard() {
            const lb = JSON.parse(localStorage.getItem('quizLB') || '[]');
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = lb.slice(0,10).map((item, i) => 
                `<div class="lb-item"><span class="lb-rank">#\( {i+1}</span> <span> \){item.name}</span> <span>${item.score}%</span></div>`
            ).join('') || '<p style="color:#95a5a6;">هنوز امتیازی ثبت نشده</p>';
        }

        function saveScore() {
            const name = document.getElementById('player-name').value.trim() || 'ناشناس';
            const score = document.getElementById('final-score').textContent;
            let lb = JSON.parse(localStorage.getItem('quizLB') || '[]');
            lb.push({ name, score: parseInt(score), date: new Date().toLocaleDateString('fa-IR') });
            lb.sort((a,b) => b.score - a.score);
            localStorage.setItem('quizLB', JSON.stringify(lb.slice(0,50)));
            loadLeaderboard();
        }

        function restartQuiz() {
            document.getElementById('result-section').style.display = 'none';
            startQuiz();
        }
    </script>
</body>
</html>
